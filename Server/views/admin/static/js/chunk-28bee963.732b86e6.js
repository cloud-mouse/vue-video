(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-28bee963"],{"6b42":function(e,t,a){},"970f":function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return o}));var i=a("b775"),n={getList:function(e){return Object(i["a"])({url:"/admin-api/gallery",method:"get",params:e})},addItem:function(e){return Object(i["a"])({url:"/admin-api/gallery",method:"post",headers:{"Content-Type":"multipart/form-data"},data:e})},deleteImg:function(e){return Object(i["a"])({url:"/admin-api/gallery",method:"delete",params:e})},editItem:function(e){return Object(i["a"])({url:"/admin-api/gallery",method:"patch",data:e})}},o={getGalleryClass:function(e){return Object(i["a"])({url:"/admin-api/gallery/class",method:"get",params:e})},deleteItem:function(e){return Object(i["a"])({url:"/admin-api/gallery/class",method:"delete",params:e})},addItem:function(e){return Object(i["a"])({url:"/admin-api/gallery/class",method:"post",data:e})},editItem:function(e){return Object(i["a"])({url:"/admin-api/gallery/class",method:"patch",data:e})}}},ab3b:function(e,t,a){},bb2e:function(e,t,a){},d0cb:function(e,t,a){"use strict";var i=a("ab3b"),n=a.n(i);n.a},fdbc:function(e,t,a){"use strict";var i=a("bb2e"),n=a.n(i);n.a},fdc3:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"resource-view"},[a("div",{staticClass:"resource-content"},[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"图片",name:"1"}},[a("img-resources")],1)],1)],1)])},n=[],o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"img-resources"},[a("el-row",[a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:24}},[a("el-button",{attrs:{type:"primary",size:"small"},nativeOn:{click:function(t){return e.showUpload(t)}}},[e._v("上传图片")])],1)],1),e._v(" "),a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"content"},[a("el-col",{staticStyle:{background:"#f5f5f5",padding:"20px 10px"},attrs:{span:4}},[a("el-button",{staticStyle:{width:"100%"},attrs:{size:"small",icon:"el-icon-folder-add"},on:{click:e.addGroup}},[e._v("添加分组\n      ")]),e._v(" "),a("div",{staticClass:"group-box"},[a("div",{staticClass:"default-node"},[a("span",{on:{click:e.getAll}},[e._v("全部")]),e._v(" "),a("span",{on:{click:e.getNotGrouped}},[e._v("未分组")])]),e._v(" "),a("el-tree",{attrs:{data:e.groupData,"node-key":"_id","current-node-key":0,"default-expand-all":"","highlight-current":!0,"expand-on-click-node":!1,"default-expanded-keys":e.defaultExpandedKeys},on:{"node-click":e.chooseCategory},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,n=t.data;return a("span",{staticClass:"custom-tree-node"},[n._id||0===n._id?a("span",{staticClass:"group_name"},[n.showInput?e._e():a("span",[e._v(e._s(n.name))]),e._v(" "),n.showInput?a("el-input",{directives:[{name:"focus",rawName:"v-focus"}],staticClass:"writeInput",attrs:{size:"mini",placeholder:"请输入"},on:{blur:function(t){return e.editCategoryName(n)}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.target.blur(t)}},model:{value:n.name,callback:function(t){e.$set(n,"name",t)},expression:"data.name"}}):e._e()],1):a("el-input",{directives:[{name:"focus",rawName:"v-focus"}],staticClass:"writeInput",attrs:{size:"mini",placeholder:"请输入内容"},on:{blur:function(t){return e.addCategory(n)}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.target.blur(t)}},model:{value:n.name,callback:function(t){e.$set(n,"name",t)},expression:"data.name"}}),e._v(" "),a("span",[0!==n._id?a("el-tooltip",{staticClass:"item",attrs:{content:"添加子分类",placement:"top"}},[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-plus"},on:{click:function(t){return t.stopPropagation(),function(){return e.addCategoryShow(n)}()}}})],1):e._e(),e._v(" "),0!==n._id?a("el-tooltip",{staticClass:"item",attrs:{content:"重命名",placement:"top"}},[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(t){return t.stopPropagation(),function(){return e.goInput(i,n)}()}}})],1):e._e(),e._v(" "),0!==n._id?a("el-tooltip",{staticClass:"item",attrs:{content:"删除分类",placement:"top"}},[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(t){return t.stopPropagation(),function(){return e.remove(i,n)}()}}})],1):e._e()],1)],1)}}])})],1)],1),e._v(" "),a("el-col",{staticStyle:{padding:"0 20px"},attrs:{span:20}},[a("div",{staticClass:"img-list"},[e._l(e.imgList,(function(t,i){return a("div",{key:i,staticClass:"img-item"},[a("el-image",{attrs:{src:t.path,lazy:""}}),e._v(" "),a("el-checkbox",{attrs:{label:e.limetedStr(t.name,16),title:t.name},model:{value:t.checked,callback:function(a){e.$set(t,"checked",a)},expression:"item.checked"}}),e._v(" "),a("el-col",[a("el-button",{attrs:{type:"text"},on:{click:function(a){return a.stopPropagation(),e.showdialog("modifyName",t)}}},[e._v("改名")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return a.stopPropagation(),e.showdialog("modifyGroup",t)}}},[e._v("分组")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return a.stopPropagation(),e.deleteImg(t._id)}}},[e._v("删除")])],1)],1)})),e._v(" "),0==e.imgList.length?a("div",{staticStyle:{padding:"20px","text-align":"center"}},[e._v("\n          暂无图片...\n        ")]):e._e()],2),e._v(" "),a("div",{staticClass:"paging"},[e.pageInfo.count?a("div",{staticClass:"page-ctn"},[a("el-pagination",{staticClass:"pull-left",attrs:{layout:"total, sizes, prev, pager, next, jumper",small:!0,"page-sizes":[10,15,20,30],"current-page":e.pageInfo.currentPage,"page-size":e.pageInfo.pageSize,total:e.pageInfo.count},on:{"current-change":e.changeList,"size-change":e.handleSizeChange}})],1):e._e()])])],1),e._v(" "),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"上传图片",visible:e.uploadDialog},on:{"update:visible":function(t){e.uploadDialog=t}}},[a("el-form",{ref:"fileUploadForm",attrs:{model:e.uploadForm,rules:e.uploadRules}},[a("el-form-item",{attrs:{label:"图片分组"}},[a("el-cascader",{staticStyle:{width:"100%"},attrs:{options:e.groupData,props:e.optionProps},on:{change:e.imgGroupChose},model:{value:e.checkedGroup,callback:function(t){e.checkedGroup=t},expression:"checkedGroup"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"本地图片",prop:"images"}},[e._l(e.uploadImageList,(function(t,i){return a("span",{key:i,staticClass:"show-imgBox"},[a("i",{staticClass:"el-icon-circle-close delete",on:{click:function(t){return e.deleteShowImg(i)}}}),e._v(" "),a("img",{attrs:{src:e.getUrl(t.raw),alt:"",width:"100",height:"100"},on:{click:function(a){e.preview(e.getUrl(t.raw))}}})])})),e._v(" "),a("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{action:"","file-list":e.uploadImageList,"http-request":e.saveImg,"show-file-list":!1,multiple:!0,"auto-upload":!1,"on-change":e.changeImgList,"on-success":e.fileUploadSuccess}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],2),e._v(" "),a("el-form-item",[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.uploadDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.fileUpload}},[e._v("确 定")])],1)],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"添加分组",visible:e.addGroupDialog},on:{"update:visible":function(t){e.addGroupDialog=t}}},[a("el-form",{ref:"groupForm",attrs:{model:e.groupForm,rules:e.groupRules}},[a("el-form-item",{attrs:{label:"所属分组"}},[a("el-cascader",{staticStyle:{width:"100%"},attrs:{options:e.groupData,props:e.optionProps},on:{change:e.handleChange},model:{value:e.checkedGroup,callback:function(t){e.checkedGroup=t},expression:"checkedGroup"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"分组名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入分组名称"},model:{value:e.groupForm.name,callback:function(t){e.$set(e.groupForm,"name",t)},expression:"groupForm.name"}})],1),e._v(" "),a("el-form-item",[a("el-button",{on:{click:function(t){e.addGroupDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addGrops}},[e._v("确 定")])],1)],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"modifyName"==e.changeFormName?"修改名称":"修改分组",visible:e.changeGroupDialog,width:"30%"},on:{"update:visible":function(t){e.changeGroupDialog=t}}},[a("el-form",{ref:"changeFrom",attrs:{model:e.changeFrom,rules:e.groupRules}},["modifyGroup"==e.changeFormName?a("el-form-item",{attrs:{label:"选择分组"}},[a("el-cascader",{staticStyle:{width:"100%"},attrs:{options:e.groupData,props:e.optionProps},on:{change:e.setImgGroup},model:{value:e.checkedGroup,callback:function(t){e.checkedGroup=t},expression:"checkedGroup"}})],1):e._e(),e._v(" "),"modifyName"==e.changeFormName?a("el-form-item",{attrs:{label:"图片名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入图片名称"},model:{value:e.changeFrom.name,callback:function(t){e.$set(e.changeFrom,"name",t)},expression:"changeFrom.name"}})],1):e._e(),e._v(" "),a("el-form-item",[a("el-button",{on:{click:function(t){e.changeGroupDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.ensureChange}},[e._v("确 定")])],1)],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"图片展示",visible:e.previewDialog.show},on:{"update:visible":function(t){return e.$set(e.previewDialog,"show",t)}}},[a("img",{attrs:{width:"100%",src:e.previewDialog.url,alt:""}})])],1)},s=[],r=(a("ac6a"),a("7f7f"),a("970f")),c={directives:{focus:{inserted:function(e){e.querySelector("input").focus()}}},data:function(){return{groupData:[],imgList:[],defaultExpandedKeys:[],nodeType:"",baseUrl:Object({NODE_ENV:"production",VUE_APP_BASE_API:"http://movie.zhanghaoblog.top",BASE_URL:""}).VUE_APP_BASE_UPLOAD_URL,keyword:"",uploadDialog:!1,addGroupDialog:!1,changeGroupDialog:!1,changeFormName:"",optionProps:{checkStrictly:!0,expandTrigger:"hover",value:"_id",label:"name"},previewDialog:{show:!1,url:""},checkedGroup:[],uploadImageList:[],uploadForm:{_id:"",class_id:"",images:[]},changeFrom:{img_id:"",class_id:"",name:""},groupForm:{pid:"",name:""},uploadRules:{},groupRules:{name:[{required:!0,message:"请输入分组名称",trigger:"blur"}]},uploadCount:0,selectGroupId:"",pageInfo:{currentPage:1,pageSize:10,count:0},loading:!0,deleteArr:[]}},watch:{imgList:{handler:function(e,t){var a=[];e.map((function(e){!0===e.checked&&a.push(e._id)})),this.deleteArr=a},deep:!0,immediate:!0}},created:function(){this.fetchData()},methods:{fetchData:function(){this.getGroupList(),this.getImgList()},getGroupList:function(){var e=this;r["b"].getGalleryClass().then((function(t){e.groupData=t.data.list}))},getImgList:function(){var e=this;r["a"].getList({pageSize:this.pageInfo.pageSize,currentPage:this.pageInfo.currentPage,class_id:this.selectGroupId,name:this.keyword}).then((function(t){e.loading=!1,e.imgList=t.data.list,e.pageInfo.count=t.data.count})).catch((function(){e.loading=!1,e.$message({type:"info",message:"图库获取失败！"})}))},showUpload:function(){this.uploadDialog=!0},addGroup:function(){this.addGroupDialog=!0},showdialog:function(e,t){this.changeFormName=e,this.changeGroupDialog=!0,this.changeFrom._id=t._id},ensureChange:function(){"modifyName"===this.changeFormName?this.changeImgName():this.changeImgGrops()},changeImgGrops:function(){var e=this;r["a"].editItem({_id:this.changeFrom._id,galleryClass:this.changeFrom.class_id[0]||0}).then((function(t){e.$message({type:"success",message:"修改成功!"}),e.getImgList(),e.changeGroupDialog=!1,e.checkedGroup=[],e.changeFrom.class_id=""})).catch((function(){e.$message({type:"info",message:"修改失败"})}))},changeImgName:function(){var e=this;r["a"].editItem({_id:this.changeFrom._id,name:this.changeFrom.name}).then((function(t){e.$message({type:"success",message:"修改成功!"}),e.getImgList(),e.changeGroupDialog=!1,e.changeFrom.name=""})).catch((function(){e.$message({type:"info",message:"修改失败"})}))},setImgGroup:function(e){this.changeFrom.class_id=e.slice(-1)},preview:function(e){this.previewDialog.show=!0,this.previewDialog.url=e},deleteShowImg:function(e){this.uploadImageList.splice(e,1)},changeImgList:function(e,t){var a="image/jpeg"===e.raw.type||"image/png"===e.raw.type,i=e.size/1024/1024<2;return a?i?void(a&&i&&(this.uploadImageList=t)):(this.$message.error("上传头像图片大小不能超过 2MB!"),t.pop(),i):(this.$message.error("上传头像图片只能是 JPG 格式!"),t.pop(),a)},fileUploadSuccess:function(e,t,a){this.uploadCount++,this.uploadCount===a.length&&(this.uploadCount=0,this.uploadDialog=!1,this.$message({message:"上传图片成功",type:"success"}))},handleChange:function(e){this.groupForm.pid=e.slice(-1)},imgGroupChose:function(e){this.uploadForm.class_id=e.slice(-1)},remove:function(e,t){var a=this;this.$confirm("此操作将永久删除该分组, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){r["b"].deleteItem({_id:t._id}).then((function(e){a.$message({type:"success",message:"删除成功!"})})),setTimeout((function(){a.fetchData()}),1e3)})).catch((function(){a.$message({type:"info",message:"已取消删除"})}))},addGrops:function(){var e=this;r["b"].addItem({name:this.groupForm.name,pid:this.groupForm.pid[0]||"0"}).then((function(t){e.$message({type:"success",message:"添加成功"}),e.getGroupList(),e.checkedGroup=[],e.addGroupDialog=!1,e.$refs.groupForm.resetFields()})).catch((function(){e.$message({type:"info",message:"添加失败"})}))},saveImg:function(e){var t=this,a=new FormData;a.append("file",e.file),a.append("class_id",this.uploadForm.class_id);var i=this.$loading({lock:!0,text:"图片上传中",spinner:"el-icon-loading",background:"rgba(255, 255, 255, 0.5)"});r["a"].addItem(a).then((function(e){200===e.code?(t.$message({message:e.msg||"上传成功",type:"success"}),t.getImgList(),t.uploadDialog=!1,t.checkedGroup=[],t.uploadImageList=[],t.$refs.fileUploadForm.resetFields(),i.close()):(i.close(),t.$message({message:e.msg||"上传失败",type:"error"}))}))},fileUpload:function(){var e=this;this.$refs.fileUploadForm.validate((function(t){t&&e.$refs.upload.submit()}))},chooseCategory:function(e,t){this.pageInfo.currentPage=1,""!==e._id&&(this.selectGroupId=e._id,this.getImgList())},checkAll:function(){var e=this;this.imgList.forEach((function(t,a){e.$set(t,"checked",!0),e.deleteArr.push(t._id)}))},unCheckAll:function(){var e=this;this.imgList.forEach((function(t,a){e.$set(t,"checked",!1),e.deleteArr=[]}))},changeList:function(e){this.pageInfo.currentPage=e,this.getImgList()},handleSizeChange:function(e){this.pageInfo.pageSize=e,this.getImgList()},getAll:function(){this.selectGroupId="",this.pageInfo.currentPage=1,this.getImgList()},getNotGrouped:function(){this.selectGroupId="0",this.pageInfo.currentPage=1,this.getImgList()},deleteImg:function(e){var t=this;this.$confirm("此操作将永久删除图片, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){r["a"].deleteImg({_id:e||JSON.stringify(t.deleteArr)}).then((function(e){t.$message({type:"success",message:"删除成功!"})})),setTimeout((function(){t.getImgList()}),200)})).catch((function(){t.$message({type:"info",message:"删除失败！"})}))},goInput:function(e,t){this.$set(t,"showInput",!0)},addCategoryShow:function(e){var t=this;void 0!==e.group_id&&this.defaultExpandedKeys.push(e.group_id),this.$nextTick((function(){var a={group_id:"",pid:e._id,name:"新增分类",level:e.level+1,showInput:!1};e.children||t.$set(e,"children",[]),e.children.push(a)}))},addCategory:function(e){var t=this;r["b"].addItem({name:e.name,pid:e.pid}).then((function(e){t.$message({message:e.msg,type:"success"}),t.fetchData(),t.nodeType=""})).catch((function(){t.$message({type:"info",message:"添加失败！"})}))},editCategoryName:function(e){var t=this;e.showInput=!1,r["b"].editItem({_id:e._id,name:e.name}).then((function(e){t.$message({message:e.msg,type:"success"}),t.fetchData()})).catch((function(){t.$message({type:"info",message:"编辑失败！"})}))}}},l=c,u=(a("fdbc"),a("ff71"),a("2877")),d=Object(u["a"])(l,o,s,!1,null,null,null),p=d.exports,g={components:{ImgResources:p},data:function(){return{activeName:"1"}},created:function(){},methods:{handleClick:function(e){console.log("tag",e)}}},m=g,h=(a("d0cb"),Object(u["a"])(m,i,n,!1,null,"2f1a3198",null));t["default"]=h.exports},ff71:function(e,t,a){"use strict";var i=a("6b42"),n=a.n(i);n.a}}]);