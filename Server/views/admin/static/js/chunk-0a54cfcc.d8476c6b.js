(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0a54cfcc"],{"0fea":function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));var a=n("b775"),i={authorityList:function(e){return Object(a["a"])({url:"/admin-api/permission",method:"get",params:e})},addRole:function(e){return Object(a["a"])({url:"/admin-api/role",method:"post",data:e})},editRole:function(e){return Object(a["a"])({url:"/admin-api/role",method:"patch",data:e})},roleList:function(e){return Object(a["a"])({url:"/admin-api/role",method:"get",params:e})},roleDetail:function(e){return Object(a["a"])({url:"/admin-api/role",method:"get",params:e})},delRole:function(e){return Object(a["a"])({url:"/admin-api/role",method:"delete",params:e})}},r={getAdminList:function(e){return Object(a["a"])({url:"/admin-api/admin",method:"get",params:e})},addAdmin:function(e){return Object(a["a"])({url:"/admin-api/admin",method:"post",data:e})},delAdmin:function(e){return Object(a["a"])({url:"/admin-api/admin",method:"get",params:e})},editAdmin:function(e){return Object(a["a"])({url:"/admin-api/admin",method:"patch",data:e})}},o={getList:function(e){return Object(a["a"])({url:"/admin-api/permission",method:"get",params:e})},addItem:function(e){return Object(a["a"])({url:"/admin-api/permission",method:"post",data:e})},updateItem:function(e){return Object(a["a"])({url:"/admin-api/permission",method:"patch",data:e})},deleteItem:function(e){return Object(a["a"])({url:"/admin-api/permission",method:"delete",params:e})}}},2740:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=this,n=t.$createElement,a=t._self._c||n;return a("div",{staticClass:"role-edit roles"},[a("div",{staticClass:"title-info"},[a("card-tag",{attrs:{"tag-name":""!=t.id?"编辑角色":"新增角色"}})],1),t._v(" "),a("div",{staticClass:"form-info"},[a("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"80px","label-position":"top",size:"small"}},[a("el-form-item",{attrs:{label:"角色名称",prop:"role_name"}},[a("el-input",{staticStyle:{width:"30%"},model:{value:t.form.role_name,callback:function(e){t.$set(t.form,"role_name",e)},expression:"form.role_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"角色权限"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"permission-tree"},[a("el-tree",{ref:"tree",attrs:{data:t.authorityList,props:t.defaultProps,"default-expand-all":"","show-checkbox":"","node-key":"_id","expand-on-click-node":!1,"render-content":t.renderContent},on:{"node-expand":t.handleNodeExpand,check:t.checkHandle}})],1)]),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.onSubmit("form")}}},[t._v("保存")]),t._v(" "),a("el-button",{on:{click:function(){return e.$router.go(-1)}}},[t._v("取消")])],1)],1)],1)])},i=[],r=(n("ac6a"),n("28a5"),n("b319")),o=n("0fea"),s={components:{CardTag:r["a"]},data:function(){return{id:"",loading:!1,expand_all:!1,authorityList:[],form:{role_name:"",permission:[]},rules:{role_name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]},defaultProps:{children:"children",label:"title"}}},computed:{},created:function(){this.getPermission(),this.id=this.$route.query.id?this.$route.query.id:"",this.$route.query.id&&this.getRoleInfo(this.$route.query.id)},mounted:function(){},methods:{getPermission:function(){var e=this;o["b"].getList().then((function(t){e.authorityList=t.data.list}))},loadNode:function(e,t){t()},renderContent:function(e,t){var n=t.node,a=(t.data,t.store,"");return 0===n.childNodes.length?a="floatRight":n.childNodes.length>0&&(a="clearFloat"),e("span",{class:a},[n.label])},handleNodeExpand:function(){this.changeCss()},changeCss:function(){this.$nextTick((function(){for(var e=document.getElementsByClassName("floatRight"),t=0;t<e.length;t++){var n=e[t].parentNode;n.style.cssFloat="left",n.style.styleFloat="left"}for(var a=document.getElementsByClassName("clearFloat"),i=0;i<a.length;i++){var r=a[i].parentNode;r.style.clear="both",r.style.clear="both"}}))},getRoleInfo:function(e){var t=this,n=this;this.loading=!0,o["c"].roleDetail({id:e}).then((function(e){t.form._id=e.data._id,t.form.role_name=e.data.role_name,t.form.permission=e.data.permission;var a=[];a=e.data.permission.split(","),setTimeout((function(){a.forEach((function(e){n.$refs.tree.setChecked(e,!0,!1)})),n.loading=!1}),500)}))},checkHandle:function(e){var t=this.$refs.tree.getHalfCheckedKeys().join(","),n=this.$refs.tree.getCheckedKeys().join(",");t.length&&n.length?this.form.permission=t+","+n:t.length&&0===n.length?this.form.permission=t:0===t.length&&n.length?this.form.permission=n:this.form.permission=""},onSubmit:function(e){var t=this,n=this;n.$refs[e].validate((function(e){if(!e)return!1;n.form._id?o["c"].editRole(n.form).then((function(e){t.$message({type:"success",message:e.msg}),n.$router.go(-1)})).catch((function(){t.$message({type:"error",message:"更新失败"})})):o["c"].addRole(n.form).then((function(e){t.$message({type:"success",message:e.msg}),n.$router.go(-1)})).catch((function(){t.$message({type:"info",message:"创建失败"})}))}))}}},l=s,d=n("2877"),c=Object(d["a"])(l,a,i,!1,null,null,null);t["default"]=c.exports}}]);