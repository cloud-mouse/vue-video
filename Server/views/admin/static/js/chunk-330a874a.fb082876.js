(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-330a874a"],{"093a":function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"a",(function(){return n})),a.d(t,"c",(function(){return o}));var i=a("b775"),r={getList:function(e){return Object(i["a"])({url:"/admin-api/movieClass",method:"get",params:e})},addItem:function(e){return Object(i["a"])({url:"/admin-api/movieClass",method:"post",data:e,headers:{"Content-Type":"application/json; charset=utf-8"}})},updateItem:function(e){return Object(i["a"])({url:"/admin-api/movieClass",method:"patch",data:e})},deleteItem:function(e){return Object(i["a"])({url:"/admin-api/movieClass",method:"delete",params:e})}},n={getList:function(e){return Object(i["a"])({url:"/admin-api/movie",method:"get",params:e})},addItem:function(e){return Object(i["a"])({url:"/admin-api/movie",method:"post",data:e})},deleteItem:function(e){return Object(i["a"])({url:"/admin-api/movie",method:"delete",params:e})},updateItem:function(e){return Object(i["a"])({url:"/admin-api/movie",method:"patch",data:e})}},o={getList:function(e){return Object(i["a"])({url:"/admin-api/movieEpisodes",method:"get",params:e})},addItem:function(e){return Object(i["a"])({url:"/admin-api/movieEpisodes",method:"post",data:e})},deleteItem:function(e){return Object(i["a"])({url:"/admin-api/movieEpisodes",method:"delete",params:e})},updateItem:function(e){return Object(i["a"])({url:"/admin-api/movieEpisodes",method:"patch",data:e})}}},"1ae9":function(e,t,a){},"3a59":function(e,t,a){"use strict";var i=a("1ae9"),r=a.n(i);r.a},"970f":function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return n}));var i=a("b775"),r={getList:function(e){return Object(i["a"])({url:"/admin-api/gallery",method:"get",params:e})},addItem:function(e){return Object(i["a"])({url:"/admin-api/gallery",method:"post",headers:{"Content-Type":"multipart/form-data"},data:e})},deleteImg:function(e){return Object(i["a"])({url:"/admin-api/gallery",method:"delete",params:e})},editItem:function(e){return Object(i["a"])({url:"/admin-api/gallery",method:"patch",data:e})}},n={getGalleryClass:function(e){return Object(i["a"])({url:"/admin-api/gallery/class",method:"get",params:e})},deleteItem:function(e){return Object(i["a"])({url:"/admin-api/gallery/class",method:"delete",params:e})},addItem:function(e){return Object(i["a"])({url:"/admin-api/gallery/class",method:"post",data:e})},editItem:function(e){return Object(i["a"])({url:"/admin-api/gallery/class",method:"patch",data:e})}}},9820:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"video-list main-content"},[a("div",{staticClass:"screen-box"},[a("div",{staticClass:"screen-item"},[a("el-input",{staticStyle:{width:"220px"},attrs:{size:"small",placeholder:"输入关键词",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.fetchData(t)}},model:{value:e.keywords,callback:function(t){e.keywords=t},expression:"keywords"}}),e._v(" "),a("el-select",{attrs:{size:"small",clearable:"",placeholder:"请选择影视分类"},model:{value:e.movie_class,callback:function(t){e.movie_class=t},expression:"movie_class"}},e._l(e.videoClassList,(function(e){return a("el-option",{key:e._id,attrs:{label:e.name,value:e._id}})})),1),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-search",type:"primary"},nativeOn:{click:function(t){return e.fetchData(t)}}},[e._v("搜索")])],1),e._v(" "),a("div",{staticClass:"operation"},[a("el-button",{attrs:{size:"small",icon:"el-icon-plus",type:"primary"},on:{click:function(t){return e.showDialog("add")}}},[e._v("新增")])],1)]),e._v(" "),a("div",{staticClass:"content"},[a("el-table",{attrs:{data:e.videoList}},[a("el-table-column",{attrs:{label:"封面",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("img",{staticClass:"cover",attrs:{src:e.row.cover,width:"30",alt:""}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"剧名",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"分类",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.movie_class?a("span",[e._v(e._s(t.row.movie_class.name))]):a("span",[e._v("未选择分类")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"pv",label:"浏览量",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"sort",label:"排序",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"首页推荐",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{value:t.row.recommend,"active-value":"1","inactive-value":"0"},on:{change:function(a){return e.changeRecommend(t.row)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"是否完结",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e._f("statusFilter")(t.row.isOver)}},[e._v(e._s("0"===t.row.isOver?"未完结":"已完结"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("timeFormat")(t.row.createTime))+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"updateTime",label:"更新时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("timeFormat")(t.row.updateTime))+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("router-link",{attrs:{to:"episodes/?id="+t.row._id}},[a("el-button",{attrs:{size:"mini"}},[e._v("剧集")])],1),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(a){return e.showDialog("edit",t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.row._id)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("div",{staticClass:"pagination-box"},[a("el-pagination",{attrs:{total:e.total,"current-page":e.currentPage,"page-sizes":[5,10,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{center:"",title:"add"==e.dialogType?"新增影视":"edit"==e.dialogType?"编辑影视":"影视详情",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"130px","label-position":"rigth",size:"small"}},[a("el-form-item",{attrs:{label:"影视名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"输入影视名称",disabled:"detail"==e.dialogType},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"影视分类",prop:"movie_class"}},[a("el-select",{attrs:{clearable:"","value-key":"_id",placeholder:"请选择影视分类",disabled:"detail"==e.dialogType},on:{change:e.changeClass},model:{value:e.currentClass,callback:function(t){e.currentClass=t},expression:"currentClass"}},e._l(e.videoClassList,(function(e){return a("el-option",{key:e._id,attrs:{label:e.name,value:e}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"影视种类",prop:"movie_type"}},[a("el-select",{attrs:{clearable:"",placeholder:"请先选择影视分类",disabled:"detail"==e.dialogType},model:{value:e.form.movie_type,callback:function(t){e.$set(e.form,"movie_type",t)},expression:"form.movie_type"}},e._l(e.currentClass.type,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"影视类型",prop:"movie_genres"}},[a("el-select",{attrs:{clearable:"",placeholder:"请先选择影视分类",disabled:"detail"==e.dialogType},model:{value:e.form.movie_genres,callback:function(t){e.$set(e.form,"movie_genres",t)},expression:"form.movie_genres"}},e._l(e.currentClass.genres,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"上映年代",prop:"year"}},[a("el-date-picker",{attrs:{format:"","value-format":"yyyy",type:"year",placeholder:"选择影视年代"},model:{value:e.form.year,callback:function(t){e.$set(e.form,"year",t)},expression:"form.year"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"影视封面",prop:"cover"}},[a("img-upload",{attrs:{disabled:"detail"==e.dialogType,"img-data":e.form.cover,"pic-max":1},on:{chooseImg:e.imageChoose}}),e._v(" "),a("el-input",{attrs:{placeholder:"您还可以输入封面url，这将不会录入图库资源",clearable:""},model:{value:e.form.cover,callback:function(t){e.$set(e.form,"cover",t)},expression:"form.cover"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"影视描述"}},[a("el-input",{attrs:{placeholder:"输入影视描述",type:"textarea",disabled:"detail"==e.dialogType},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"影视排序"}},[a("el-input",{attrs:{placeholder:"输入影视排序",disabled:"detail"==e.dialogType},model:{value:e.form.sort,callback:function(t){e.$set(e.form,"sort",t)},expression:"form.sort"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"首页推荐"}},[a("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:e.form.recommend,callback:function(t){e.$set(e.form,"recommend",t)},expression:"form.recommend"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"是否完结"}},[a("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:e.form.isOver,callback:function(t){e.$set(e.form,"isOver",t)},expression:"form.isOver"}})],1),e._v(" "),a("el-form-item",["detail"!==e.dialogType?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("form")}}},[e._v("保存")]):a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogType="edit"}}},[e._v("编辑")]),e._v(" "),a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")])],1)],1)],1)],1)},r=[],n=a("093a"),o=a("ed08"),s=a("5aa9"),l={components:{ImgUpload:s["a"]},filters:{timeFormat:function(e){return Object(o["b"])(new Date(e))},statusFilter:function(e){var t={1:"success",0:"danger"};return t[e]}},data:function(){return{loading:!0,keywords:"",videoList:[],videoClassList:[],dialogFormVisible:!1,form:{name:"",cover:"",movie_class:"",movie_type:"",movie_genres:"",year:"",recommend:"0",isOver:"0",sort:"0",description:""},pageSize:10,currentPage:1,total:0,currentClass:{},movie_class:"",movie_type:"",movie_genres:"",rules:{name:[{required:!0,trigger:"blur",message:"请填写影视名称"}],movie_class:[{required:!0,trigger:"change",message:"请选择影视分类"}],movie_type:[{required:!0,trigger:"change",message:"请选择影视种类"}],movie_genres:[{required:!0,trigger:"change",message:"请选择影视类型"}],year:[{required:!0,trigger:"change",message:"请选择影视年代"}],icon:[{required:!0,trigger:"blur",message:"请上传影视封面"}]},dialogType:"add"}},watch:{dialogFormVisible:function(e){!1===e&&(this.form={name:"",description:"",cover:"",movie_class:"",movie_type:"",movie_genres:"",year:"",recommend:"0",isOver:"0",sort:"0"},this.currentClass={},this.$refs.form.resetFields(),this.$refs.form.clearValidate())}},created:function(){this.fetchData()},mounted:function(){this.getVideoClass()},methods:{fetchData:function(){var e=this;n["a"].getList({pageSize:this.pageSize,currentPage:this.currentPage,keywords:this.keywords,movie_class:this.movie_class,movie_type:this.movie_type,movie_genres:this.movie_genres}).then((function(t){e.videoList=t.data.list,e.total=t.data.count}))},getVideoClass:function(){var e=this;n["b"].getList({pageSize:1e3,currentPage:1}).then((function(t){e.videoClassList=t.data.list}))},changeRecommend:function(e){var t=this;this.$confirm("是否修改首页推荐?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",confirmButtonClass:"danger"}).then((function(){n["a"].updateItem({_id:e._id,recommend:"0"===e.recommend?"1":"0"}).then((function(e){t.$message.success(e.msg||"修改成功"),t.dialogFormVisible=!1,t.fetchData()})).catch((function(e){t.$message.error(e||"编辑失败!")}))})).catch((function(){t.$message({type:"info",message:"已取消修改"})}))},changeClass:function(e){this.form.movie_class=e._id,this.form.movie_type="",this.form.movie_genres=""},showDialog:function(e,t){this.dialogType=e,this.dialogFormVisible=!0,t&&t._id&&(this.currentClass=t.movie_class,this.form=JSON.parse(JSON.stringify(t)),this.form.movie_class=this.form.movie_class._id)},onSubmit:function(e){var t=this,a=this;a.$refs[e].validate((function(i){if(!i)return!1;a.form._id?n["a"].updateItem(a.form).then((function(i){t.$message.success(i.msg),t.$nextTick((function(){a.$refs[e].resetFields()})),t.dialogFormVisible=!1,t.fetchData()})).catch((function(e){t.$message.error(e||"编辑失败!")})):n["a"].addItem(a.form).then((function(i){t.$message.success(i.msg),t.$nextTick((function(){a.$refs[e].resetFields()})),t.dialogFormVisible=!1,t.fetchData()})).catch((function(e){t.$message.error(e||"添加失败!")}))}))},imageChoose:function(e){this.form.cover=e,this.$refs.form.validateField("cover")},handleCurrentChange:function(e){this.currentPage=e,this.fetchData()},handleSizeChange:function(e){this.pageSize=e,this.fetchData()},handleDelete:function(e){var t=this;this.$confirm("是否删除该影视?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",confirmButtonClass:"danger"}).then((function(){n["a"].deleteItem({id:e}).then((function(e){t.$message({type:"success",message:"删除成功!"}),t.fetchData()}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))}}},c=l,m=(a("3a59"),a("2877")),u=Object(m["a"])(c,i,r,!1,null,"edc1751a",null);t["default"]=u.exports}}]);